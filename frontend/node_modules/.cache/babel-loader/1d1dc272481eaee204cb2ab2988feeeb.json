{"ast":null,"code":"import _asyncToGenerator from\"/Users/ziyizhang/Desktop/springboard/heroku/personal_ledger/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/ziyizhang/Desktop/springboard/heroku/personal_ledger/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import _regeneratorRuntime from\"/Users/ziyizhang/Desktop/springboard/heroku/personal_ledger/frontend/node_modules/@babel/runtime/regenerator/index.js\";import{BrowserRouter}from\"react-router-dom\";import React,{useState,useEffect}from\"react\";import jwt from\"jwt-decode\";import LedgerApi from'./Api/api';import useLocalStorage from\"./hooks/useLocalStorage\";import UserContext from\"./auth/UserContext\";import ProfileForm from\"./profiles/ProfileForm\";import{Route,Routes,Navigate}from\"react-router-dom\";import LoginForm from\"./auth/LoginForm\";import Profile from'./profiles/Profile';import TotalExpenses from'./expenses/TotalExpenses';import Navigation from'./routes-nav/Navigation';import ExpenseForm from'./expenses/ExpenseForm';import CurrentMonthExpenses from'./expenses/CurrentMonthExpenses';import AnnualExpenses from'./expenses/AnnualExpenses';import MonthlyExpenses from'./expenses/MonthlyExpenses';import SearchMonthly from'./expenses/SearchMonthly';import LoadingSpinner from'./common/LoadingSpinner';import SignupForm from'./auth/SignupForm';import UpdateExpense from'./expenses/UpdateExpense';import Homepage from'./homepage/Homepage';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";export var TOKEN_STORAGE_ID=\"ledger-token\";function App(){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),infoLoaded=_useState2[0],setInfoLoaded=_useState2[1];var _useState3=useState(null),_useState4=_slicedToArray(_useState3,2),currentUser=_useState4[0],setCurrentUser=_useState4[1];var _useLocalStorage=useLocalStorage(TOKEN_STORAGE_ID),_useLocalStorage2=_slicedToArray(_useLocalStorage,2),token=_useLocalStorage2[0],setToken=_useLocalStorage2[1];console.debug(\"App\",\"infoLoaded=\",infoLoaded,\"currentUser=\",currentUser,\"token=\",token);// Load user info from API. Until a user is logged in and they have a token,\n// this should not run. It only needs to re-run when a user logs out, so\n// the value of the token is a dependency for this effect.\nuseEffect(function loadUserInfo(){console.debug(\"App useEffect loadUserInfo\",\"token=\",token);function getCurrentUser(){return _getCurrentUser.apply(this,arguments);}// set infoLoaded to false while async getCurrentUser runs; once the\n// data is fetched (or even if an error happens!), this will be set back\n// to false to control the spinner.\nfunction _getCurrentUser(){_getCurrentUser=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var _jwt,username,_currentUser;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(!token){_context.next=14;break;}_context.prev=1;_jwt=jwt(token),username=_jwt.username;// put the token on the Api class so it can use it to call the API.\nLedgerApi.token=token;_context.next=6;return LedgerApi.getCurrentUser(username);case 6:_currentUser=_context.sent;setCurrentUser(_currentUser);_context.next=14;break;case 10:_context.prev=10;_context.t0=_context[\"catch\"](1);console.error(\"App loadUserInfo: problem loading\",_context.t0);setCurrentUser(null);case 14:setInfoLoaded(true);case 15:case\"end\":return _context.stop();}}},_callee,null,[[1,10]]);}));return _getCurrentUser.apply(this,arguments);}setInfoLoaded(false);getCurrentUser();},[token]);/** Handles site-wide logout. */function logout(){setCurrentUser(null);setToken(null);}/** Handles site-wide signup.\n   *\n   * Automatically logs them in (set token) upon signup.\n   *\n   * Make sure you await this function and check its return value!\n   */function signup(_x){return _signup.apply(this,arguments);}/** Handles site-wide login.\n     *\n     * Make sure you await this function and check its return value!\n     */function _signup(){_signup=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(signupData){var _token;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return LedgerApi.signup(signupData);case 3:_token=_context2.sent;setToken(_token);return _context2.abrupt(\"return\",{success:true});case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(\"signup failed\",_context2.t0);return _context2.abrupt(\"return\",{success:false,errors:_context2.t0});case 12:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return _signup.apply(this,arguments);}function login(_x2){return _login.apply(this,arguments);}function _login(){_login=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(loginData){var _token2;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return LedgerApi.login(loginData);case 3:_token2=_context3.sent;setToken(_token2);return _context3.abrupt(\"return\",{success:true});case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.error(\"login failed\",_context3.t0);return _context3.abrupt(\"return\",{success:false,errors:_context3.t0});case 12:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return _login.apply(this,arguments);}if(!infoLoaded)return/*#__PURE__*/_jsx(LoadingSpinner,{});return/*#__PURE__*/_jsx(BrowserRouter,{children:/*#__PURE__*/_jsxs(UserContext.Provider,{value:{currentUser:currentUser,setCurrentUser:setCurrentUser},children:[/*#__PURE__*/_jsx(Navigation,{logout:logout}),/*#__PURE__*/_jsxs(Routes,{login:login,signup:signup,children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",element:/*#__PURE__*/_jsx(Homepage,{})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/login\",element:/*#__PURE__*/_jsx(LoginForm,{login:login})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/register\",element:/*#__PURE__*/_jsx(SignupForm,{singup:signup})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/expenses\",element:/*#__PURE__*/_jsx(TotalExpenses,{})}),/*#__PURE__*/_jsx(Route,{path:\"expenses/year/:year\",element:/*#__PURE__*/_jsx(AnnualExpenses,{})}),/*#__PURE__*/_jsx(Route,{path:\"expenses/currentmonth\",element:/*#__PURE__*/_jsx(CurrentMonthExpenses,{})}),/*#__PURE__*/_jsx(Route,{path:\"expenses/searchmonthly\",element:/*#__PURE__*/_jsx(SearchMonthly,{})}),/*#__PURE__*/_jsx(Route,{path:\"expenses/year/:year/month/:month\",element:/*#__PURE__*/_jsx(MonthlyExpenses,{})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/expenses/add\",element:/*#__PURE__*/_jsx(ExpenseForm,{})}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/profile\",element:/*#__PURE__*/_jsx(Profile,{})}),/*#__PURE__*/_jsx(Route,{path:\"/:username/edit\",element:/*#__PURE__*/_jsx(ProfileForm,{})}),/*#__PURE__*/_jsx(Route,{path:\"/expenses/:username/:id\",element:/*#__PURE__*/_jsx(UpdateExpense,{})}),/*#__PURE__*/_jsx(Route,{path:\"*\",element:/*#__PURE__*/_jsx(Navigate,{replace:true,to:\"/\"})})]})]})});}export default App;","map":{"version":3,"names":["BrowserRouter","React","useState","useEffect","jwt","LedgerApi","useLocalStorage","UserContext","ProfileForm","Route","Routes","Navigate","LoginForm","Profile","TotalExpenses","Navigation","ExpenseForm","CurrentMonthExpenses","AnnualExpenses","MonthlyExpenses","SearchMonthly","LoadingSpinner","SignupForm","UpdateExpense","Homepage","TOKEN_STORAGE_ID","App","infoLoaded","setInfoLoaded","currentUser","setCurrentUser","token","setToken","console","debug","loadUserInfo","getCurrentUser","username","error","logout","signup","signupData","success","errors","login","loginData"],"sources":["/Users/ziyizhang/Desktop/springboard/heroku/personal_ledger/frontend/src/App.js"],"sourcesContent":["import { BrowserRouter } from \"react-router-dom\";\nimport React, { useState, useEffect } from \"react\";\nimport jwt from \"jwt-decode\";\nimport LedgerApi from './Api/api';\nimport useLocalStorage from \"./hooks/useLocalStorage\";\nimport UserContext from \"./auth/UserContext\";\nimport ProfileForm from \"./profiles/ProfileForm\";\nimport {Route,Routes,Navigate} from \"react-router-dom\";\nimport LoginForm from \"./auth/LoginForm\";\nimport Profile from './profiles/Profile';\nimport TotalExpenses from './expenses/TotalExpenses';\nimport Navigation from './routes-nav/Navigation';\nimport ExpenseForm from './expenses/ExpenseForm';\nimport CurrentMonthExpenses from './expenses/CurrentMonthExpenses';\nimport AnnualExpenses from './expenses/AnnualExpenses';\nimport MonthlyExpenses from './expenses/MonthlyExpenses';\nimport SearchMonthly from './expenses/SearchMonthly';\nimport LoadingSpinner from './common/LoadingSpinner';\nimport SignupForm from './auth/SignupForm';\nimport UpdateExpense from './expenses/UpdateExpense';\nimport Homepage from './homepage/Homepage';\n\n\nexport const TOKEN_STORAGE_ID = \"ledger-token\";\n\nfunction App() {\n  const [infoLoaded, setInfoLoaded] = useState(false);\n  const [currentUser, setCurrentUser] = useState(null);\n  const [token, setToken] = useLocalStorage(TOKEN_STORAGE_ID);\n\n  console.debug(\n      \"App\",\n      \"infoLoaded=\", infoLoaded,\n      \"currentUser=\", currentUser,\n      \"token=\", token,\n  );\n\n  // Load user info from API. Until a user is logged in and they have a token,\n  // this should not run. It only needs to re-run when a user logs out, so\n  // the value of the token is a dependency for this effect.\n\n  useEffect(function loadUserInfo() {\n    console.debug(\"App useEffect loadUserInfo\", \"token=\", token);\n\n    async function getCurrentUser() {\n      if (token) {\n        try {\n          let { username } = jwt(token);\n          // put the token on the Api class so it can use it to call the API.\n          LedgerApi.token = token;\n          let currentUser = await LedgerApi.getCurrentUser(username);\n          setCurrentUser(currentUser);\n        } catch (err) {\n          console.error(\"App loadUserInfo: problem loading\", err);\n          setCurrentUser(null);\n        }\n      }\n      setInfoLoaded(true);\n    }\n\n    // set infoLoaded to false while async getCurrentUser runs; once the\n    // data is fetched (or even if an error happens!), this will be set back\n    // to false to control the spinner.\n    setInfoLoaded(false);\n    getCurrentUser();\n  }, [token]);\n\n    /** Handles site-wide logout. */\n    function logout() {\n      setCurrentUser(null);\n      setToken(null);\n      }\n    /** Handles site-wide signup.\n   *\n   * Automatically logs them in (set token) upon signup.\n   *\n   * Make sure you await this function and check its return value!\n   */\n     async function signup(signupData) {\n      try {\n        let token = await LedgerApi.signup(signupData);\n        setToken(token);\n        return { success: true };\n      } catch (errors) {\n        console.error(\"signup failed\", errors);\n        return { success: false, errors };\n      }\n      }\n  \n    /** Handles site-wide login.\n     *\n     * Make sure you await this function and check its return value!\n     */\n    async function login(loginData) {\n      try {\n        let token = await LedgerApi.login(loginData);\n        setToken(token);\n        return { success: true };\n      } catch (errors) {\n        console.error(\"login failed\", errors);\n        return { success: false, errors };\n      }\n    }\n\n\n  if (!infoLoaded) return <LoadingSpinner />;\n\n  return (\n      <BrowserRouter>\n        <UserContext.Provider\n            value={{ currentUser, setCurrentUser }}>\n            {/* <Paths login={login} signup={signup} /> */}\n            <Navigation logout={logout} />\n            {/* <NavBar /> */}\n            <Routes login={login} signup={signup}>\n                <Route exact path='/' element={<Homepage/>}></Route>\n                <Route exact path='/login' element={<LoginForm login={login} />}></Route>\n                <Route exact path='/register' element={<SignupForm singup={signup} />}></Route>\n                <Route exact path='/expenses' element={<TotalExpenses />}></Route>\n                <Route path = 'expenses/year/:year' element={<AnnualExpenses />}></Route>\n                <Route path = 'expenses/currentmonth' element={<CurrentMonthExpenses />}></Route>\n                <Route path = 'expenses/searchmonthly' element={<SearchMonthly />}></Route>\n                <Route path = 'expenses/year/:year/month/:month' element={<MonthlyExpenses />}></Route>\n                <Route exact path='/expenses/add' element={<ExpenseForm />}></Route>\n                <Route exact path='/profile' element = {<Profile />}></Route>\n                <Route path='/:username/edit' element = {<ProfileForm />}></Route>\n                <Route path = '/expenses/:username/:id' element = {<UpdateExpense />}></Route>\n                <Route path=\"*\" element={<Navigate replace to=\"/\" />}/>\n            </Routes>\n        </UserContext.Provider>\n      </BrowserRouter>\n  );\n}\n\nexport default App;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}